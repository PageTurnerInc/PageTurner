{% extends 'base.html' %}
{% load static %}

{% block content %}
<h1>Welcome {{ user }} </h1>

{% if account.get_is_premium %}
    <h2>Premium Account</h2>

{% elif not account.get_is_premium %}
    <h2>Regular Account</h2>

{% endif %}

<p>Fullname: {{ account.full_name }}</p>
<p>Email: {{ account.email }}</p>

<a class="nav-link active" aria-current="page" href="{% url 'daftar_belanja:shopping_cart' %}">
    <button type="button" class="btn btn-primary" id="button_add">
        Shopping Cart
    </button>
</a>

<br>

<a class="nav-link active" aria-current="page" href="{% url 'daftar_belanja:add_book' %}">
    <button type="button" class="btn btn-primary" id="button_add">
        Go Back to Catalogue
    </button>
</a>

<br>

<table id="book_owned" class="book_owned"></table>

<script>
    async function getOwnedBooks() {
        return fetch("{% url 'daftar_belanja:get_owned_books' %}").then((res) => res.json())
    }

    async function refreshTable() {
        const books = await getOwnedBooks()
        const bookCatalogue = document.getElementById("book_owned")

        bookCatalogue.innerHTML = "";

        let htmlString = `
        <tr>
            <th>Title</th>
            <th>Author</th>
            <th>ISBN</th>
            <th>Publisher</th>
            <th>Remove</th>
        </tr>`

        books.forEach((item) => {
            htmlString += `
            \n<tr>
                <td>${item.fields.book_title}</td>
                <td>${item.fields.book_author}</td>
                <td>${item.fields.isbn}</td>
                <td>${item.fields.year_of_publication}</td>
            </tr>`
        })

        document.getElementById("book_owned").innerHTML = htmlString
    }

    refreshTable();
</script>

{% endblock content %}